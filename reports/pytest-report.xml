<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="0" failures="7" skipped="0" tests="54" time="6.154" timestamp="2025-06-15T20:19:01.261882+00:00" hostname="6ec6a1092816"><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_init_01_get_buddy_flows" time="2.631"><failure message="TypeError: list indices must be integers or slices, not str">self = &lt;tests.test_buddy_api.TestBuddyApi object at 0xffff89888d90&gt;
api_client = &lt;rest_framework.test.APIClient object at 0xffff892dda50&gt;
buddy_user = &lt;User: Buddy User (ID: 300)&gt;
flow_factory = &lt;function flow_factory.&lt;locals&gt;.create_flow at 0xffff88ef4f40&gt;

    def test_b_init_01_get_buddy_flows(self, api_client, buddy_user, flow_factory):
        """B-INIT-01: GET /api/buddy/flows/ — только is_active=true."""
        flow_factory(title="Active Flow", is_active=True)
        flow_factory(title="Inactive Flow", is_active=False)
    
        api_client.force_authenticate(user=buddy_user)
        response = api_client.get('/api/buddy/flows/')
    
        assert response.status_code == status.HTTP_200_OK
&gt;       assert response.data['count'] == 1
E       TypeError: list indices must be integers or slices, not str

tests/test_buddy_api.py:27: TypeError</failure></testcase><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_init_02_get_buddy_users" time="0.027"><failure message="TypeError: list indices must be integers or slices, not str">self = &lt;tests.test_buddy_api.TestBuddyApi object at 0xffff898894d0&gt;
api_client = &lt;rest_framework.test.APIClient object at 0xffff892fe010&gt;
buddy_user = &lt;User: Buddy User (ID: 300)&gt;
user_factory = &lt;function user_factory.&lt;locals&gt;.create_user at 0xffff88ce2e80&gt;

    def test_b_init_02_get_buddy_users(self, api_client, buddy_user, user_factory):
        """B-INIT-02: GET /api/buddy/users/ — список всех активных пользователей."""
        active = user_factory(telegram_id='active_user_for_buddy', name='Active User', is_active=True)
        inactive = user_factory(telegram_id='inactive_user_for_buddy', name='Inactive User', is_active=False)
    
        api_client.force_authenticate(user=buddy_user)
        response = api_client.get('/api/buddy/users/')
    
        assert response.status_code == status.HTTP_200_OK
    
&gt;       telegram_ids = [u['telegram_id'] for u in response.data['results']]
E       TypeError: list indices must be integers or slices, not str

tests/test_buddy_api.py:41: TypeError</failure></testcase><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_init_03_start_flow_for_user" time="0.037" /><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_init_05_start_flow_already_active" time="0.024" /><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_mgmt_01_get_my_managed_flows" time="0.039"><failure message="TypeError: list indices must be integers or slices, not str">self = &lt;tests.test_buddy_api.TestBuddyApi object at 0xffff8988a0d0&gt;
api_client = &lt;rest_framework.test.APIClient object at 0xffff895315d0&gt;
buddy_user = &lt;User: Buddy User (ID: 300)&gt;
managed_user_flow = &lt;UserFlow: Test User - Simple Flow&gt;

    def test_b_mgmt_01_get_my_managed_flows(self, api_client, buddy_user, managed_user_flow):
        """B-MGMT-01: GET /api/buddy/my-flows/ — только те, где текущий пользователь — buddy."""
        api_client.force_authenticate(user=buddy_user)
        response = api_client.get('/api/buddy/my-flows/')
    
        assert response.status_code == status.HTTP_200_OK
&gt;       assert response.data['count'] == 1
E       TypeError: list indices must be integers or slices, not str

tests/test_buddy_api.py:94: TypeError</failure></testcase><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_mgmt_02_get_ward_progress" time="0.066" /><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_mgmt_03_pause_flow" time="0.028" /><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_mgmt_04_resume_flow" time="0.031" /><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_mgmt_05_delete_flow" time="0.043" /><testcase classname="tests.test_buddy_api.TestBuddyApi" name="test_b_mgmt_06_pause_foreign_flow" time="0.029" /><testcase classname="tests.test_common_utils.TestWorkingDaysUtils" name="test_add_working_days_simple" time="0.007" /><testcase classname="tests.test_common_utils.TestWorkingDaysUtils" name="test_add_working_days_across_weekend" time="0.007" /><testcase classname="tests.test_common_utils.TestWorkingDaysUtils" name="test_add_working_days_with_holidays" time="0.011" /><testcase classname="tests.test_common_utils.TestWorkingDaysUtils" name="test_add_zero_or_negative_days" time="0.003" /><testcase classname="tests.test_common_utils.TestWorkingDaysUtils" name="test_get_working_days_simple" time="0.004" /><testcase classname="tests.test_common_utils.TestWorkingDaysUtils" name="test_get_working_days_with_holidays" time="0.009" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_01_get_flow_details_unauthorized" time="0.007" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_01_get_flow_details_authenticated" time="0.022" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_04_get_article_details" time="0.032" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_02_get_flow_steps_list" time="0.071"><failure message="TypeError: list indices must be integers or slices, not str">self = &lt;tests.test_content_api.TestContentApi object at 0xffff896ff110&gt;
api_client = &lt;rest_framework.test.APIClient object at 0xffff894cc550&gt;
user = &lt;User: Test User (ID: 100)&gt;
started_user_flow = &lt;UserFlow: Test User - Complex Flow&gt;

    def test_cnt_02_get_flow_steps_list(self, api_client, user, started_user_flow):
        """CNT-02: GET /api/flows/{id}/steps/ — отдаёт только доступные + текущий шаг."""
        flow = started_user_flow.flow
        api_client.force_authenticate(user=user)
    
        response = api_client.get(f'/api/flows/{flow.id}/steps/')
        assert response.status_code == status.HTTP_200_OK
    
        # В реализации view FlowStepListView отдает все шаги, а не только доступные.
        # Клиент должен сам определять доступность по полю is_accessible в прогрессе.
        # Поэтому мы просто проверяем, что все шаги на месте.
&gt;       assert response.data['count'] == flow.flow_steps.count()
E       TypeError: list indices must be integers or slices, not str

tests/test_content_api.py:87: TypeError</failure></testcase><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_03_get_flow_steps_order" time="0.049"><failure message="TypeError: list indices must be integers or slices, not str">self = &lt;tests.test_content_api.TestContentApi object at 0xffff896ff090&gt;
api_client = &lt;rest_framework.test.APIClient object at 0xffff894133d0&gt;
user = &lt;User: Test User (ID: 100)&gt;
started_user_flow = &lt;UserFlow: Test User - Complex Flow&gt;

    def test_cnt_03_get_flow_steps_order(self, api_client, user, started_user_flow):
        """CNT-03: Порядок order в ответе не нарушается."""
        flow = started_user_flow.flow
        api_client.force_authenticate(user=user)
    
        response = api_client.get(f'/api/flows/{flow.id}/steps/')
        assert response.status_code == status.HTTP_200_OK
    
&gt;       orders = [step['order'] for step in response.data['results']]
E       TypeError: list indices must be integers or slices, not str

tests/test_content_api.py:97: TypeError</failure></testcase><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_05_read_step_first_time" time="0.059" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_06_read_step_second_time" time="0.055" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_07_get_content_before_accessible" time="0.038" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_08_get_task_after_accessible" time="0.050" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_09_10_post_quiz_answer" time="0.104" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_11_quiz_completion_unlocks_next_step" time="0.089" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_12_answer_foreign_quiz_question" time="0.040" /><testcase classname="tests.test_content_api.TestContentApi" name="test_cnt_13_quiz_shuffle" time="0.131" /><testcase classname="tests.test_e2e_full_system" name="test_e2e_03_full_system" time="0.493" /><testcase classname="tests.test_e2e_user_flow" name="test_e2e_01_full_user_flow" time="0.041"><failure message="TypeError: list indices must be integers or slices, not str">api_client = &lt;rest_framework.test.APIClient object at 0xffff895092d0&gt;
buddy_user = &lt;User: Buddy User (ID: 300)&gt;, user = &lt;User: Test User (ID: 100)&gt;
flow_with_steps = &lt;Flow: Complex Flow&gt;, report_data = []

    def test_e2e_01_full_user_flow(
        api_client: APIClient,
        buddy_user: User,
        user: User,
        flow_with_steps: Flow,
        report_data: list
    ):
        """
        Тестирует полный жизненный цикл взаимодействия пользователя с системой.
        """
    
        # Шаг 0: Бадди смотрит пользователей всех
        api_client.force_authenticate(user=buddy_user)
        users_url = '/api/buddy/users/'
        response = api_client.get(users_url)
        assert response.status_code == 200, f"Expected 200, got {response.status_code} from {users_url}"
&gt;       assert any(u['telegram_id'] == user.telegram_id for u in response.json()['results'])
E       TypeError: list indices must be integers or slices, not str

tests/test_e2e_user_flow.py:41: TypeError</failure></testcase><testcase classname="tests.test_flows.TestFlowModel" name="test_calculate_completion_date_no_steps" time="0.005" /><testcase classname="tests.test_flows.TestFlowModel" name="test_calculate_completion_date_with_steps" time="0.019" /><testcase classname="tests.test_flows.TestFlowModel" name="test_calculate_completion_date_with_holidays" time="0.011" /><testcase classname="tests.test_flows.TestFlowStartApi" name="test_start_flow_no_deadline_calculates_auto" time="0.035" /><testcase classname="tests.test_flows.TestFlowStartApi" name="test_start_flow_with_deadline_uses_provided" time="0.023" /><testcase classname="tests.test_moderator_api" name="test_e2e_02_full_moderator_flow" time="0.036" /><testcase classname="tests.test_moderator_api" name="test_admin_endpoints_require_moderator" time="0.009" /><testcase classname="tests.test_my_api.TestMyApi" name="test_my_01_get_my_profile_unauthorized" time="0.003" /><testcase classname="tests.test_my_api.TestMyApi" name="test_my_01_get_my_profile_authorized" time="0.009" /><testcase classname="tests.test_my_api.TestMyApi" name="test_my_02_get_my_flows_list" time="0.017"><failure message="TypeError: list indices must be integers or slices, not str">self = &lt;tests.test_my_api.TestMyApi object at 0xffff896e8e10&gt;
api_client = &lt;rest_framework.test.APIClient object at 0xffff88dece90&gt;
user = &lt;User: Test User (ID: 100)&gt;
user_flow_factory = &lt;function user_flow_factory.&lt;locals&gt;.create_user_flow at 0xffff88ba5a80&gt;
flow_factory = &lt;function flow_factory.&lt;locals&gt;.create_flow at 0xffff88ba5940&gt;

    def test_my_02_get_my_flows_list(self, api_client, user, user_flow_factory, flow_factory):
        """
        MY-02: GET /api/my/flows/ — список только активных Flow, к которым пользователь назначен
        """
        # Потоки, назначенные пользователю
        active_flow = flow_factory(title="Active Assigned Flow", is_active=True)
        inactive_flow = flow_factory(title="Inactive Assigned Flow", is_active=False)
        user_flow_factory(user=user, flow=active_flow, status=UserFlow.FlowStatus.IN_PROGRESS)
        user_flow_factory(user=user, flow=inactive_flow)
    
        # Поток, не назначенный пользователю
        flow_factory(title="Unassigned Flow", is_active=True)
    
        api_client.force_authenticate(user=user)
        response = api_client.get('/api/my/flows/')
    
        assert response.status_code == status.HTTP_200_OK
&gt;       assert response.data['count'] == 1
E       TypeError: list indices must be integers or slices, not str

tests/test_my_api.py:45: TypeError</failure></testcase><testcase classname="tests.test_my_api.TestMyApi" name="test_my_03_get_my_progress_aggregated" time="0.033" /><testcase classname="tests.test_my_api.TestMyApi" name="test_my_04_get_progress_for_my_flow" time="0.018" /><testcase classname="tests.test_my_api.TestMyApi" name="test_my_05_get_progress_for_other_flow" time="0.014" /><testcase classname="tests.test_progress_business_rules.TestProgressBusinessRules" name="test_prg_01_first_step_available_on_start" time="0.032" /><testcase classname="tests.test_progress_business_rules.TestProgressBusinessRules" name="test_prg_02_second_step_locked" time="0.046" /><testcase classname="tests.test_progress_business_rules.TestProgressBusinessRules" name="test_prg_03_flow_completed_after_last_step" time="0.067" /><testcase classname="tests.test_progress_business_rules.TestProgressBusinessRules" name="test_prg_04_steps_inaccessible_when_paused" time="0.046" /><testcase classname="tests.test_progress_business_rules.TestProgressBusinessRules" name="test_prg_05_modify_progress_in_paused_state" time="0.048" /><testcase classname="tests.test_progress_business_rules.TestProgressBusinessRules" name="test_prg_06_estimated_time_sum" time="0.010" /><testcase classname="tests.test_utils" name="test_generate_random_string_default_length" time="0.003" /><testcase classname="tests.test_utils" name="test_generate_random_string_letters_only" time="0.002" /><testcase classname="tests.test_utils" name="test_generate_secure_token_length_and_hex" time="0.002" /><testcase classname="tests.test_utils" name="test_generate_secure_token_uniqueness" time="0.066" /></testsuite></testsuites>